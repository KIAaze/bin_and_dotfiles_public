#!/bin/bash

# path setup
export PATH=$PATH:$HOME/bin
export PATH=$PATH:$HOME/opt/bin
export PATH=$PATH:$HOME/bin/public_bin
export PATH=$PATH:$HOME/Development/script_inception_public/bin

# python setup
export PYTHONSTARTUP=$HOME/.pystartup
export PYTHONPATH=$PYTHONPATH:$HOME/Development/script_inception_public

export PROMPTSTYLE=3

export MATLABPATH=$HOME/MATLAB

export MODULEPATH=$MODULEPATH:$HOME/modulefiles

##########################################################
##### Modules for working on BC

##### Important notes:

### "module" does not return error on failure unfortunately making success checks problematic

### apps/meep-1.2.1-mpi
# libraries/gnu_builds/h5utils-1.12.1 must be loaded after apps/meep-1.2.1-mpi, else
# /usr/mpi/gcc/mvapich2-1.7-qlc/bin/mpirun
# will be used instead of
# /usr/mpi/gcc/mvapich-1.2.0-qlc/bin/mpirun
#
# /usr/mpi/gcc/mvapich2-1.7-qlc/bin/mpirun leads to this error:
# PMGR_COLLECTIVE ERROR: unitialized MPI task: Missing required environment variable: MPIRUN_RANK

### apps/python-meep-1.3
# requires libraries/gnu_builds/gsl-1.16
# works with: /cm/shared/apps/openmpi/gcc/64/1.6.5/bin/mpirun

### apps/matlab-r2015a
# This module will break git HTTPS pull/push because it changes libcurl from:
# /usr/lib64/libcurl.so.4
# to:
# /cm/shared/apps/Matlab-R2015a/bin/glnxa64/libcurl.so.4

loadgit() {
  ### git
  module unload apps/matlab-r2015a
  module load tools/git-1.8.4.2
  # module load tools/git-1.7.9
}

loadmatlab() {
  module load apps/matlab-r2015a
  # module load apps/matlab-r2013a
  # module load apps/matlab-r2013b
  # module load matlab-R2014a-x86_64
  # module load apps/matlab-R2009a
}

loadModules() {
  ### for qsub
  module load shared default-environment

  ### required for python-meep
  module load libraries/gnu_builds/gsl-1.16
  # module load gnu_builds/gsl-1.13
  # module load gnu_builds/gsl

  ### for meep
  module load apps/python-meep-1.3 # loads different mpirun!!!
  # module load apps/meep-1.2.1-mpi
  # module load apps/meep-1.2-mpi
  # module load meep-mpi
  # module load apps/meep-mpi

  ### h5utils
  module load libraries/gnu_builds/h5utils-1.12.1
  # module load gnu_builds/h5utils

  ### python
  module load languages/python-3.3.2
  # module load languages/python-2.7.10
  # module load languages/python-2.7.6-sklearn
  # module load languages/python-2.7.6
  # module load languages/python-2.7.5
  # module load languages/python-2.7.2
  # module load languages/python-2.7
  # module load languages/python-2.6.8

  ### paraview
  module load apps/paraview-4.3.1
  # module load apps/paraview-4.0.1
  # module load apps/paraview-3.8

  ### misc
  # module load apps/phylobayes-4.1-serial-gsl
  # module load apps/phylobayes-3.3f-serial-gsl

  # module load languages/fpc-2.4.0

  # module load gnu_builds/hdf5.mpi

  # module load mpiexec/0.84_432
  # module load tools/mpiexec-0.84
  # module load mvapich/gcc/64/1.2.0-qlc

  # module load shared torque moab
  # module load libraries/gnu_builds/atlas-3.10.1
  
  ### load most recent matlab
  loadmatlab
}

if declare -f module >/dev/null
then
  loadModules &> /dev/null
fi
##########################################################

#case $(hostname) in
# bigblue*) export PPN=8;;
# bluecrystal*) export PPN=4;;
# babyblue*) export PPN=4;;
# *) export PPN=1;;
#esac

#BC1:
#92 nodes each with two dual-core Opteron processors, memory 8 GB RAM per node (2 GB per core)
#ppn=4
#2GB/core
#8GB/node

#BC2:
#416 nodes each with 2 x 2.8 GHz 4 core Intel Harpertown E5462 processors, memory 8 GB RAM per node (1GB per core), 193GB scratch space on /local
#ppn=8
#1GB/core
#8GB/node

#BC3:
#223 base blades which have 16 x 2.6Hz SandyBridge cores, 4GB/core and a 1TB SATA disk.
#ppn=16
#4GB/core
#64GB/node

# 360 hours
# export TORQUE_QUEUE=long

# 120 hours
# export TORQUE_QUEUE=short

# export PPN=1
# export PPN=2
# export PPN=16

### queues:
# testq              --      --    01:00:00   --    1   3 --   E R
# veryshort          --      --    12:00:00   --  223 1703 --   E R
# short              --      --    120:00:0   --  108 1051 --   E R
# medium             --      --    240:00:0   --   58  18 --   E R
# long               --      --    360:00:0   --   88 123 --   E R
